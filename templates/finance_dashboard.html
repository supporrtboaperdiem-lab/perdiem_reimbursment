<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Finance Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: "Inter", system-ui, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #6a0f1a;
        }

        header {
            background: rgba(106, 15, 26, 0.85);
            backdrop-filter: blur(8px);
            color: #fff;
            padding: 18px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 6px 18px rgba(0,0,0,0.35);
        }

        header h1 {
            font-size: 22px;
            margin: 0;
            font-weight: 700;
        }

        .logout {
            color: #fff;
            text-decoration: none;
            font-weight: 600;
        }

        .logout:hover {
            text-decoration: underline;
            color: #ffdede;
        }

        .Delegate {
            color: #fff;
            text-decoration: none;
            font-weight: 600;
        }

        .Delegate:hover {
            text-decoration: underline;
            color: #ffdede;
        }

        .container {
            padding: 12px 28px;
            width: 90%;
            max-width: 90vw;
            margin: auto;
        }

        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 28px 30px;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 16px;
            color: #6a0f1a;
            font-size: 18px;
            font-weight: 700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            border-radius: 12px;
            overflow: hidden;
        }

        table th,
        table td {
            padding: 14px 12px;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
        }

        table th {
            background: #f0f3f7;
            font-weight: 700;
        }

        .status { font-weight:700; }
        .status.SUBMITTED { color: #cc8400; }
        .status.APPROVED_BY_REQUESTOR_ADMIN { color: #8c32a7; }
        .status.APPROVED_BY_INTERMEDIATE_APPROVER { color: #22afd2; }
        .status.APPROVED_BY_FINAL_APPROVER { color: #28cf6e; }
        .status.APPROVED_BY_MANAGERIAL_APPROVER { color: #28cf6e; }
        .status.APPROVED { color: #1e8e3e; } 

        .status.DECLINED_BY_REQUESTOR_ADMIN { color: #ff1414; } 
        .status.DECLINED_BY_INTERMEDIATE_APPROVER { color: #ff1414; } 
        .status.DECLINED_BY_MANAGERIAL_APPROVER { color: #ff1414; } 
        .status.DECLINED_BY_FINAL_APPROVER { color: #ff1414; } 
        .status.PROCESSED_BY_FINANCE { color: #1e8e3e; }
        .status.DECLINED_BY_FINANCE { color: #ff1414; } 


        .btn {
            background: linear-gradient(135deg, #6a0f1a, #8b1d2c);
            color: #fff;
            border: none;
            padding: 12px 22px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-review {
            background: linear-gradient(135deg, #2c7be5, #1a4fa3);


        }

        .btn-process {
            background: linear-gradient(135deg, #3f15ea, #1a4fa3);


        }

        .btn-pdf {
            background: linear-gradient(135deg, #248e1e, #0b5d2a);
        }

        .btn-gene {
            background: linear-gradient(135deg, #FFC857, #b67c07);
        }

        .money {
            font-weight: 600;
            color: #1e3a8a;
        }

        .approved {
            display: inline-flex;
            align-items: center;
            gap: 6px;

            color: #2e7d32;
            background: #eaf6ee;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .approved::before {
            content: "âœ“";
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;

            background: #2e7d32;
            color: #ffffff;
            border-radius: 50%;
            font-size: 11px;
        }

        .Delegate { color:white; font-weight:600; cursor:pointer; }
        .Delegate:hover { text-decoration:underline }
        .card {
            background:white; margin:20px auto; padding:20px;
            border-radius:12px; width:90%;
        }

        /* ----------------- Delegate Modal Modern UI ----------------- */
        #delegateModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            max-width: 90%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            z-index: 1000;
            color: #fff;
            transition: all 0.3s ease;
        }

        #delegateModal h3 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-weight: 700;
            font-size: 1.25rem;
        }

        /* Modern dropdown for delegate modal */
        /* Modern styled dropdown inside delegate modal */
        #delegateModal select {
            width: 100%;
            padding: 0.6rem 1rem;
            border-radius: 12px;
            border: none;
            background: rgba(42, 15, 20, 0.9);  /* dark semi-transparent */
            color: #fff; /* white text inside select */
            font-size: 0.95rem;
            font-weight: 500;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2212%22%20height%3D%227%22%20viewBox%3D%220%200%2012%207%22%20fill%3D%22none%22%20xmlns%3D%22http://www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M1%201L6%206L11%201%22%20stroke%3D%22white%22%20stroke-width%3D%222%22/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.8rem center;
            background-size: 12px 7px;
        }

        /* Options inside dropdown */
        #delegateModal select option {
            background: #6a0f1a; /* dark red matching theme */
            color: #fff; /* white text */
        }

        /* Hover and focus effect */
        #delegateModal select:hover,
        #delegateModal select:focus {
            background: rgba(42, 15, 20, 1);
            outline: none;
        }



        #delegateModal button {
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #delegateBtn, #declineBtn {
            background: linear-gradient(135deg, #6a0f1a, #8b1d2c);
            color: #fff;
        }
        #delegateBtn:hover, #declineBtn:hover { transform: scale(1.05); }

        #acceptBtn, button[onclick="closeDelegateModal()"] {
            background: linear-gradient(135deg, #2c7be5, #1a4fa3);
            color: #fff;
        }
        #acceptBtn:hover, button[onclick="closeDelegateModal()"]:hover { transform: scale(1.05); }

        #delegateOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        }

        .declined {
            display: inline-flex;
            align-items: center;
            gap: 6px;

            color: #ffffff;
            background: #ff0000;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .declined::before {
            content: "X";
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;

            background: #ff1500;
            color: #ffffff;
            border-radius: 50%;
            font-size: 11px;
        }

        /* PROFILE DROPDOWN */
.profile-wrapper {
    position: relative;
}

.profile-img {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    cursor: pointer;
    object-fit: cover;
    border: 2px solid #ffffff40;
    transition: 0.3s ease;
}

.profile-img:hover {
    transform: scale(1.08);
    box-shadow: 0 0 15px rgba(255,255,255,0.4);
}

.profile-dropdown {
    position: absolute;
    right: 0;
    top: 60px;
    width: 220px;
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    display: none;
    animation: fadeDropdown 0.2s ease;
    overflow: hidden;
    z-index: 9999;
}

.profile-dropdown a {
    display: block;
    padding: 12px 16px;
    text-decoration: none;
    font-size: 14px;
    color: #333;
    font-weight: 500;
    transition: 0.2s;
}

.profile-dropdown a:hover {
    background: #f4f4f4;
}

.profile-info {
    padding: 14px 16px;
    background: #f9f9f9;
}

.logout-item {
    color: #c73645;
    font-weight: 600;
}

@keyframes fadeDropdown {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
}
.profile-wrapper {
    display: inline-block; /* keep the image inline */
    cursor: pointer;       /* changes cursor on hover */
}

.profile-img {
    width: 80px;
    height: 50px;
    border-radius: 8px;         /* optional: rounded corners */
    object-fit: cover;          /* prevent distortion */
    transition: transform 0.3s ease, box-shadow 0.3s ease; /* smooth effect */
}

.profile-img:hover {
    transform: scale(1.2);     /* zoom in 20% */
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* subtle shadow */
}


 a.logout-item,
    a[href$="change_password"] {  /* selects your Change Password link */
        color: #F5F5DC;           /* Cream / Off-White */
        text-decoration: none;    /* Remove underline */
        transition: color 0.3s, transform 0.3s; /* smooth hover effects */
    }

    a.logout-item:hover,
    a[href$="change_password"]:hover {
        color: #FFF8E1;           /* Slightly brighter cream on hover */
        transform: scale(1.1);    /* Zoom slightly on hover */
    }

    .flash-container {
        margin-bottom: 20px;
        text-align: center;
    }

    .flash {
        padding: 10px 20px;
        margin: 5px auto;
        border-radius: 8px;
        font-weight: bold;
        width: fit-content;
        min-width: 200px;
        color: #fff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        animation: fadein 0.5s ease;
    }

    .flash-success { background-color: #4caf50; }   /* green */
    .flash-error   { background-color: #f44336; }   /* red */
    .flash-danger  { background-color: #f44336; }   /* red (alternative) */
    .flash-warning { background-color: #ff9800; }   /* orange */
    .flash-info    { background-color: #2196f3; }   /* blue */

    @keyframes fadein {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }


    </style>
</head>

<body>

<header>
    <h1>Finance Processor Menu</h1>
    
    <form method="GET"
      action="{{ url_for('generate_report.finance_report') }}"
      target="_blank"
      onsubmit="setTimeout(function(){ window.location.reload(); }, 10000);"
      style="display:flex; gap:10px; align-items:center;">

    <input type="date" name="start_date" required
           style="padding:8px; border-radius:8px; border:none;">

    <input type="date" name="end_date" required
           style="padding:8px; border-radius:8px; border:none;">

    <button type="submit" class="btn btn-gene">
        Generate Report
    </button>
</form>
    <div class="profile-wrapper" style="position: relative;">
        <img src="{{ url_for('static', filename='images/profile_1.png') }}" 
             style="width: 80px; height: 50px; cursor:pointer;" 
             class="profile-img" id="profileToggle">
    
             <div class="profile-dropdown" id="profileDropdown" style="display:none; position:absolute; right:0; top:60px; background:#000000; padding:15px; border-radius:14px; box-shadow:0 15px 40px rgba(0,0,0,0.3); z-index:1000; width:250px;">
            <div class="logout" style="margin-bottom:10px;color:#d9d940;">
                <strong>{{ current_user.username }}</strong><br>
                <small>{{ current_user.role }}</small>
            </div>
            <hr style="margin:10px 0;">
    
            <!-- Change Password Link -->
            <a href="javascript:void(0);" id="showChangePassword" 
               style="display:block; margin-bottom:10px; color:#FFC857; text-decoration:none;">Change Password</a>
    
            <!-- Inline Change Password Form -->
            <div id="changePasswordForm" style="display:none; margin-bottom:10px;">
                <form method="POST" action="{{ url_for('auth.change_password') }}">
                    <div style="margin-bottom:8px;">
                        <input type="password" name="current_password" placeholder="Current Password" required
                               style="width:85%; padding:8px; border-radius:8px; border:1px solid #ccc;">
                    </div>
                    <div style="margin-bottom:8px;">
                        <input type="password" name="new_password" placeholder="New Password" required
                               style="width:85%; padding:8px; border-radius:8px; border:1px solid #ccc;">
                    </div>
                    <div style="margin-bottom:8px;">
                        <input type="password" name="confirm_password" placeholder="Confirm Password" required
                               style="width:85%; padding:8px; border-radius:8px; border:1px solid #ccc;">
                    </div>
                    <button type="submit" class="btn" style="width:85%; background:#6a0f1a; color:#fff; border:none; padding:8px; border-radius:8px;">Update Password</button>
                </form>
            </div>
    
            <!-- Logout Link -->
            <a class="logout" href="{{ url_for('auth.logout') }}" 
               style="display:block; color:#FFC857; text-decoration:none;">Logout</a>
        </div>
    </div>
</header>

<div class="container">
    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="flash flash-{{ category }}">{{ message }}</div>
              {% endfor %}
            {% endif %}
          {% endwith %}
    /div>
    <div class="card">
        <h2>My Assigned Requests</h2>

        {% if perdiems %}
        <table>
            <thead>
                <tr>
                    <th>Perdiem ID</th>
                    <th>Aquired</th>
                    <th>Reimbursement Form</th>
                    <th>Perdiem Form</th>
                    <th>Comment</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for perdiem in perdiems %}
                    {% if current_user.role == "FINANCE" %}
                        {% if perdiem.status in ["APPROVED_BY_MANAGERIAL_APPROVER","APPROVED_BY_FINAL_APPROVER","PROCESSED_BY_FINANCE","DECLINED_BY_FINANCE"] %}
                                <tr>
                                    <td>{{ perdiem.perdiem_code }}</td>
                                    <td><b class="money"> {{ "{:,.2f}".format(perdiem.birr_amount) }}</b></td>
                                    

                                    <td>
                                            <a href="{{ url_for('view_reimburs.view_reimburs_db_pdf', request_id=perdiem.id) }}"
                                            class="btn btn-pdf" target="_blank">View PDF</a>
                                    </td>

                                    <td>
                                            <a href="{{ url_for('view_perdi.view_perdi_db_pdf', request_id=perdiem.id) }}"
                                            class="btn btn-pdf" target="_blank">View PDF</a>
                                    </td>

                                    <td>
                                            <a href="{{ url_for('adminreview.comments_view', request_id=perdiem.id) }}"
                                            class="btn btn-review" target="_blank">Comments</a>
                                    </td>

                                    <td class="status {{ perdiem.status }}">{{ perdiem.status }}</td>

                                    <td>
                                        {%  if perdiem.status in ["APPROVED_BY_MANAGERIAL_APPROVER","APPROVED_BY_FINAL_APPROVER"] %}
                                            <a href="{{ url_for('finance_processor.finance_dashboard', request_id=perdiem.id) }}"
                                            class="btn btn-process" target="_blank">Process</a>

                                        {% elif perdiem.status == "DECLINED_BY_FINANCE"%}
                                            <span class="declined" aria-label="Reviewed and declined">Declined</span>  

                                        {% else %}
                                            <span class="approved" aria-label="Reviewed and approved">processed</span>
                                            
                                        {% endif %}
                                    </td>
                                </tr>
                            
                        {% endif %}
                    {% endif %}

                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p>No  Finally Approved  Perdiem requests.</p>
        {% endif %}
    </div>
</div>

<script>
    const profileToggle = document.getElementById('profileToggle');
        const profileDropdown = document.getElementById('profileDropdown');
        const showChangePassword = document.getElementById('showChangePassword');
        const changePasswordForm = document.getElementById('changePasswordForm');
    
        // Toggle dropdown
        profileToggle.addEventListener('click', () => {
            profileDropdown.style.display = profileDropdown.style.display === 'block' ? 'none' : 'block';
            // hide form when dropdown toggled off
            if(profileDropdown.style.display === 'none') changePasswordForm.style.display = 'none';
        });
    
        // Toggle Change Password form
        showChangePassword.addEventListener('click', () => {
            changePasswordForm.style.display = changePasswordForm.style.display === 'block' ? 'none' : 'block';
        });
    
        // Optional: hide dropdown if clicked outside
        document.addEventListener('click', (e) => {
            if (!profileDropdown.contains(e.target) && !profileToggle.contains(e.target)) {
                profileDropdown.style.display = 'none';
                changePasswordForm.style.display = 'none';
            }
        });
        
    </script>

</body>
</html>

